<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta property="og:title" content="Crystal, Anteojos,crital,Tecnologia,optica,sol">
    <link rel="stylesheet" type="text/css" href="./assets/css/bootstrap.css">
    <link rel="stylesheet" href="./assets/styles/style.css">
    
    <title>Gestión de Productos</title>
<link rel="apple-touch-icon" sizes="57x57" href="./assets/img/ic/apple-icon-57x57.png">
<link rel="apple-touch-icon" sizes="60x60" href="./assets/img/ic/apple-icon-60x60.png">
<link rel="apple-touch-icon" sizes="72x72" href="./assets/img/ic/apple-icon-72x72.png">
<link rel="apple-touch-icon" sizes="76x76" href="./assets/img/ic/apple-icon-76x76.png">
<link rel="apple-touch-icon" sizes="114x114" href="./assets/img/ic/apple-icon-114x114.png">
<link rel="apple-touch-icon" sizes="120x120" href="./assets/img/ic/apple-icon-120x120.png">
<link rel="apple-touch-icon" sizes="144x144" href="./assets/img/ic/apple-icon-144x144.png">
<link rel="apple-touch-icon" sizes="152x152" href="./assets/img/ic/apple-icon-152x152.png">
<link rel="apple-touch-icon" sizes="180x180" href="./assets/img/ic/apple-icon-180x180.png">
<link rel="icon" type="image/png" sizes="144x144" href="./assets/img/ic/android-icon-144x144.png">
<link rel="icon" type="image/png" sizes="192x192" href="./assets/img/ic/android-icon-192x192.png">
<link rel="icon" type="image/png" sizes="32x32" href="./assets/img/ic/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="96x96" href="./assets/img/ic/favicon-96x96.png">
<link rel="icon" type="image/png" sizes="16x16" href="./assets/img/ic/favicon-16x16-.png">
<link rel="manifest" href="./assets/img/ic/manifest.json">
<meta name="msapplication-TileColor" content="#ffffff">
<meta name="msapplication-TileImage" content="/ms-icon-144x144.png">
<meta name="theme-color" content="#ffffff">
<script src="https://kit.fontawesome.com/548c939c5f.js" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

<!--=================================-->
</head>

<body id="titulo-shop">
    <header> 

      <nav class="navbar navbar-expand-lg bg-black">
        <div class="container-fluid ">
          <div>
            <a class="navbar-brand text-white txtShW "><img src="./assets/img/LogosdeSmart-03.png" alt="" class="img-logo"></a>           
          </div>
          <div class="col-6">
           <!-- <form class="d-flex text-white" role="search">
              <input class="form-control me-2 p-1"  id="searchnavbar" name="search" type="search" placeholder="Search" aria-label="Search">
              <button class="btn btn-outline-success" id="search"  type="submit">Search</button>
            </form>-->
          </div>
          <div class="col-2"></div>
          <div class="col-4">
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarScroll" aria-controls="navbarScroll" aria-expanded="false" aria-label="Toggle navigation">
              <span  id="btn-iconito"><i class="fa fa-bars"></i></span>
            </button>
              <div class="collapse navbar-collapse" id="navbarScroll">
              <ul class="navbar-nav me-auto my-2 my-lg-0 navbar-nav-scroll" style="--bs-scroll-height: 100px;">
                <li class="nav-item dropdown">
                  <a class="text-white nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                    Producto
                  </a>
                  <ul class="dropdown-menu">
                    <li><a class="dropdown-item" href="consultar.html">Consultar</a></li>
                    <li><a class="dropdown-item" href="agregar.html">Agregar</a></li>
                    <li><a class="dropdown-item" href="actualizar.html">Actualizar</a></li>
                    <li><a class="dropdown-item" href="actualizar.html">Elininar</a></li>
                  </ul>

                  <a class="text-white nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                    Usuarios
                  </a>
                  <ul class="dropdown-menu">
                    <li><a class="dropdown-item" href="consultar.html">Consultar</a></li>
                    <li><a class="dropdown-item" href="agregar.html">Agregar</a></li>
                    <li><a class="dropdown-item" href="actualizar.html">Actualizar</a></li>
                    <li><a class="dropdown-item" href="actualizar.html">Elininar</a></li>
                  </ul>
                </li>  
              </ul>       
              </div>   
          </div>
        </div>  
      </nav>   
        <nav class=" bg-black"> 
          <div class="container-fluid ">
          <ul class="nav justify-content-center">
                <li class="nav-item">
                  <a class="nav-link active" aria-current="page" href="index.html"> Home </a>
                </li>
                <li class="nav-item">
                  <a class="nav-link" href="productos.html"> Productos </a>
                </li>
                <li class="nav-item">
                  <a class="nav-link" href="contacto.html"> Usuarios </a>
                </li>
              
                <li class="nav-item">
                  <a class="nav-link" href="sucursales.html"> Sucursales  </a>
                </li>
              </ul>
        </div>
        </nav>
    </header>

<!--============================================================-->

<!--======================-->
<main>
  <div class="container">
    <div class="row justify-content-center">
     <div class="col-md-8">  

    <h1>Gestión de Productos</h1>
    
    <h2>Consultar Productos</h2>
    <form id="getAllProductsForm" onsubmit="getAllProducts(); return false;">
        <button  id ="products" type="submit">Obtener Todos los Productos</button>
    </form>
    <pre id="products"></pre>
    
    <h2>Buscar Producto por Referencia</h2>
    <form id="searchProductForm" onsubmit="searchProductByNombre(event)">
        <input type="text" id="searchNombre" placeholder="Referencia del producto" required>
        <button type="submit">Buscar</button>
    </form>
    <pre id="searchResult"></pre>
    
    <h2>Crear Producto</h2>
    <form id="createProductForm" onsubmit="createProduct(event)">
        <input type="text" id="createReference" placeholder="Referencia" required>
        <input type="text" id="createDescription" placeholder="Descripción" required>
        <input type="number" id="createCatId" placeholder="ID Categoría" required>
        <input type="text" id="createImage" placeholder="Imagen" required>
        <input type="number" id="createStockAct" placeholder="Stock Actual" required>
        <input type="number" id="createStockMin" placeholder="Stock Mínimo" required>
        <input type="number" id="createCost" placeholder="Costo" required>
        <input type="number" id="createPrice" placeholder="Precio" required>
        <input type="text" id="createDate" placeholder="Fecha de Ingreso" required>
        <input type="text" id="createState" placeholder="Estado" required>
        <button type="submit">Crear</button>
    </form>
    
    <h2>Actualizar Producto</h2>
    <form id="updateProductForm" onsubmit="updateProduct(event)">
        <input type="text" id="updateId" placeholder="ID del Producto" required>
        <input type="text" id="updateReference" placeholder="Referencia" required>
        <input type="text" id="updateDescription" placeholder="Descripción" required>
        <input type="number" id="updateCatId" placeholder="ID Categoría" required>
        <input type="text" id="updateImage" placeholder="Imagen" required>
        <input type="number" id="updateStockAct" placeholder="Stock Actual" required>
        <input type="number" id="updateStockMin" placeholder="Stock Mínimo" required>
        <input type="number" id="updateCost" placeholder="Costo" required>
        <input type="number" id="updatePrice" placeholder="Precio" required>
        <input type="text" id="updateDate" placeholder="Fecha de Ingreso" required>
        <input type="text" id="updateState" placeholder="Estado" required>
        <button type="submit">Actualizar</button>
    </form>
    
    <h2>Eliminar Producto</h2>
    <form id="deleteProductForm" onsubmit="deleteProduct(event)">
      <input type="text" id="deleteId" placeholder="ID del Producto" required>
      <button type="submit">Eliminar</button>
  </form>

</div>
</div>
</div>
</main>
<script>
  // Función para obtener todos los productos
  async function getAllProducts() {
      const response = await fetch('http://localhost:3003/products', {
        headers: {
    'Content-type': 'application/json'},
  });
      
      const products = await response.json();
      console.log(products);
      document.getElementById('products').innerHTML = JSON.stringify(products, null, 2);
  }

  // Función para buscar productos por referencia
  async function searchProductByNombre(event) {
      event.preventDefault();
      const nombre = document.getElementById('searchNombre').value;
      const response = await fetch(`http://localhost:3003/products/search?p_referencia=${nombre}`
        ,{
          credentials: "omit",
      });
      const product = await response.json();
      console.log(product);
      document.getElementById('searchResult').innerHTML = JSON.stringify(product, null, 2);
  }

  // Función para crear un nuevo producto
  async function createProduct(event) {
      event.preventDefault();
      const product = {
          p_referencia: document.getElementById('createReference').value,
          p_descripcion: document.getElementById('createDescription').value,
          cat_id: parseInt(document.getElementById('createCatId').value),
          p_imagen: document.getElementById('createImage').value,
          p_stock_act: parseInt(document.getElementById('createStockAct').value),
          p_stock_min: parseInt(document.getElementById('createStockMin').value),
          p_costo: parseFloat(document.getElementById('createCost').value),
          p_precio: parseFloat(document.getElementById('createPrice').value),
          p_fecha_ing: document.getElementById('createDate').value,
          p_estado: document.getElementById('createState').value
      };

      const response = await fetch('http://localhost:3003/products', {
          method: 'POST',
          headers: {
              'Content-Type': 'application/json'
          },
          body: JSON.stringify(product)
      });
      const result = await response.json();
      console.log(result);
      getAllProducts();  // Actualiza la lista de productos
  }

  // Función para actualizar un producto
  async function updateProduct(event) {
      event.preventDefault();
      const id = document.getElementById('updateId').value;
      const product = {
          p_referencia: document.getElementById('updateReference').value,
          p_descripcion: document.getElementById('updateDescription').value,
          cat_id: parseInt(document.getElementById('updateCatId').value),
          p_imagen: document.getElementById('updateImage').value,
          p_stock_act: parseInt(document.getElementById('updateStockAct').value),
          p_stock_min: parseInt(document.getElementById('updateStockMin').value),
          p_costo: parseFloat(document.getElementById('updateCost').value),
          p_precio: parseFloat(document.getElementById('updatePrice').value),
          p_fecha_ing: document.getElementById('updateDate').value,
          p_estado: document.getElementById('updateState').value
      };

      const response = await fetch(`http://localhost:3003/products/${id}`, {
          method: 'PUT',
          headers: {
              'Content-Type': 'application/json'
          },
          body: JSON.stringify(product)
      });
      const result = await response.json();
      console.log(result);
      getAllProducts();  // Actualiza la lista de productos
  }

  // Función para eliminar un producto
  async function deleteProduct(event) {
      event.preventDefault();
      const id = document.getElementById('deleteId').value;
      const response = await fetch(`http://localhost:3003/products/${id}`, {
          method: 'DELETE'
      });
      const result = await response.json();
      console.log(result);
      getAllProducts();  // Actualiza la lista de productos
  }

  // Cargar todos los productos al cargar la página
  document.addEventListener('DOMContentLoaded', getAllProducts);
</script>
</body>
</html>
